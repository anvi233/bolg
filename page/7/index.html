<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>MY BOLG</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="MY BOLG">
<meta property="og:url" content="http://jumpu.top/page/7/index.html">
<meta property="og:site_name" content="MY BOLG">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MY BOLG">
  
    <link rel="alternate" href="/atom.xml" title="MY BOLG" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">MY BOLG</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="搜索"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://jumpu.top"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="layout-node common function" class="article article-type-layout" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/01/02/node common function/" class="article-date">
  <time datetime="2017-01-02T02:51:52.000Z" itemprop="datePublished">2017-01-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/01/02/node common function/">node common function</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div></pre></td><td class="code"><pre><div class="line">1.使用requires[url]去引导模块</div><div class="line">2.使用exports或module.exports将函数或对象作为模块导出</div><div class="line">3.模块可以发布到npm中</div><div class="line">4.创建模块为多个文件的目录通常在目录下有入口文件，包含exports对象定义的文件，导入这个模块的代码可以访问到exports对象下的函数方法，也就是说exports对象下的函数方法相当于是共有方法，其他的相当于私有方法。</div><div class="line">5.require是同步操作</div><div class="line">6.引入同目录下文件的时候.js可以省略</div><div class="line">7.exports不能被重写，如模块中既有module.exports又有exports，那么返回的是module.exports，为了避免混淆一概使用module.exports就好。</div><div class="line">8.模块查找机制优先顺序：同目录&gt;node_modules目录&gt;父目录&gt;NODE_PATH指定目录</div><div class="line">9.模块是文件夹需在文件夹下有index.js入口，package.json中改main的值指定文件替代index.js</div><div class="line">10.模块作为对象缓存，相同模块第二次引用读的是缓存里的，使用monkey patching（为内置对象进行原型扩展）可以改变这种模块的行为</div><div class="line">-----------------------------------------------------</div><div class="line">11.串行化流程控制工具nimble，下载$ npm install nimble，其他流程控制工具有step，seq</div><div class="line">12.事件发射器不写error捕获会使服务器不能正常启动</div><div class="line">13.使用formidable处理上传的文件；</div><div class="line">表单提交请求带的Context-Type通常的两种值：</div><div class="line">    application/x-www-form-urlencoded(html表单的默认值)</div><div class="line">    multipart/form-data(表单中含有文件或非ASCII或二进制数据时使用)</div><div class="line">14.querystring模块的qs.parse(body)这种用来解析主体</div><div class="line">15.get/post流程：创建HTTP服务-&gt;设定响应头信息-&gt;读取数据时Buffer对象解码成字串-&gt;字串内容体拼接-&gt;字串数组拼接-&gt;数据全部读取结束输出字串数组</div><div class="line">16.RESTful Web服务：POST添加待办事务，GET显示当前事务列表，DELETE从待办事务中去除，PUT修改待办事务&gt;      </div><div class="line">    添加如：curl -d &apos;xxx&apos; http://localhost:3000</div><div class="line">    显示如：curl http://localhost:3000</div><div class="line">17.node 的REPL会话提供读取计算输出循环的简单测试环境，如：</div><div class="line">&gt; &apos;node ye&apos;.length</div><div class="line">&gt; 7</div><div class="line"></div><div class="line">&gt; require(&apos;url&apos;).parse(&apos;http://baidu.com&apos;)</div><div class="line">Url &#123;</div><div class="line">  protocol: &apos;http:&apos;,</div><div class="line">  slashes: true,</div><div class="line">  auth: null,</div><div class="line">  host: &apos;baidu.com&apos;,</div><div class="line">  port: null,</div><div class="line">  hostname: &apos;baidu.com&apos;,</div><div class="line">  hash: null,</div><div class="line">  search: null,</div><div class="line">  query: null,</div><div class="line">  pathname: &apos;/&apos;,</div><div class="line">  path: &apos;/&apos;,</div><div class="line">  href: &apos;http://baidu.com/&apos; &#125;</div><div class="line">18.&lt;form method=&quot;post&quot; action=&quot;/&quot; enctype=&quot;multipart/form-data&quot;&gt;&lt;/form&gt;适用于BLOB文件的MIME类型</div><div class="line">19.formidable按数据块接受解析并吐出特定部分，高效且不会导致内存膨胀，formidable.IncomingForm()对象默认会把上传的文件流入到/tmp目录下，在处理完表单元素后，formidable会发出事件，比如，收到文件并处理好之后会发出file事件，收完输入域会发出field事件。</div><div class="line">20.使用https，需要openSLL证书(node带有)，私钥。私钥生成：$ openssl genrsa 1024 &gt; key.pem ;证书生成：$ openssl req -x509 -days 365 -new -key key.pem &gt; cert.pem ;设置密码加密:$ </div><div class="line">openssl genrsa -des3 1024 &gt; key.pem ;通常秘钥放在~/.ssh</div><div class="line">------------------------------------------------</div><div class="line">21.基于文件的存储，待运行任务JSON转换：</div><div class="line">$ node cli_tasks.js add Floss the cat</div><div class="line">$ node cli_tasks.js list</div><div class="line">$ node cli_tasks.js add Buy some hats</div><div class="line">$ node cli_tasks.js list</div><div class="line">22.schema：数据库中的Schema，为数据库对象的集合，一个用户一般对应一个schema。</div><div class="line">官方定义如下：</div><div class="line">    A schema is a collection of database objects (used by a user.).</div><div class="line">    schema objects are the logical structures that directly refer to the database’s data.</div><div class="line">A user is a name defined in the database that can connect to and access objects.</div><div class="line">schemas and users help database administrators manage database security.</div><div class="line">    从定义中我们可以看出schema为数据库对象的集合，为了区分各个集合，我们需要给这个集合起个名字，这些名字就是我们在企业管理器的方案下看到的许多类似用户名的节点，这些类似用户名的节点其实就是一个schema，schema里面包含了各种对象如tables views sequences stored procedures synonyms indexes clusters and database links。</div><div class="line">23.redis命令sadd尝试加值到set的例子：</div><div class="line">client.sadd(&apos;ip_addresses&apos;,&apos;204.10.37.96&apos;，redis.print);</div><div class="line">24.redis采用信道通信，订阅信道的客户端会收到所有的信道信息</div><div class="line">25.使用hiredis提高redis性能，hiredis使用C语言，node内部API改变后会需要rebuild来保证可用性：</div><div class="line">npm install hiredis</div><div class="line">npm rebuild hiredis</div><div class="line">26.安装mongoose：</div><div class="line">npm install mongoose</div><div class="line">27.Connect中间件模块化组件框架处理流程：分派器收请求传给第一个中间件-&gt;记录请求日志并用next()传给下一个中间件-&gt;如有，请求体会被解析，并用next()传给下一个中间件-&gt;如请求静态文件，用哪个文件做响应，不再调用next()；否则请求进入下一个中间件-&gt;请求呗一个定制的中间件处理好，响应结束；   中间件需要三个参数，请求，响应回调的next()函数；</div><div class="line">28.测试如：node curl --user tobi:ferret http://localhost/admin/users</div><div class="line">29.connect自带的中间件</div></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>connect自带的中间件</th>
<th>connect自带的中间件</th>
</tr>
</thead>
<tbody>
<tr>
<td>cookieParser()</td>
<td>为后续中间件提供req.cookies和req.signedCookies</td>
</tr>
<tr>
<td>bodyParser()</td>
<td>为后续中间件提供req.body和req.files</td>
</tr>
<tr>
<td>limit()</td>
<td>基于给定字节长度限制请求主体的大小，必须用在bodyParser中间件之前</td>
</tr>
<tr>
<td>query()</td>
<td>为后续中间件提供req.query</td>
</tr>
<tr>
<td>logger()</td>
<td>将HTTP请求的信息输出到stdout或日志文件之类的流中</td>
</tr>
<tr>
<td>favicon()</td>
<td>响应/favicon.ico HTTP请求。通常放在中间件logger前面，这样它就不会出现在你的日志文件中了</td>
</tr>
<tr>
<td>methodOverride()</td>
<td>可以替不能使用正确请求方法的浏览器仿造req.method，依赖于bodyParser</td>
</tr>
<tr>
<td>vhost()</td>
<td>根据指定的主机名使用给定的中间件和/或HTTP服务器实例</td>
</tr>
<tr>
<td>session()</td>
<td>为用户设置一个HTTP会话，并提供一个可以跨越请求的持久化req.session对象。依赖于cookieParser</td>
</tr>
<tr>
<td>basicAuth()</td>
<td>为程序提供HTTP基本认证</td>
</tr>
<tr>
<td>csrf()</td>
<td>防止HTTP表单中的跨站请求伪造攻击，依赖于session</td>
</tr>
<tr>
<td>errorHandler()</td>
<td>当出现错误时把堆栈跟踪信息返回给客户端。在开发时很实用，不过不要用在生产环境中</td>
</tr>
<tr>
<td>static()</td>
<td>把指定目录中的文件发给HTTP客户端。跟Connect的挂载功能配合得很好</td>
</tr>
<tr>
<td>compress()</td>
<td>用gzip压缩优化HTTP响应</td>
</tr>
<tr>
<td>directory()</td>
<td>为HTTP客户端提供目录清单服务，基于客户端的Accept请求头提供经过优化的结果</td>
</tr>
</tbody>
</table>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">30.常规发送cookie的curl命令：</div><div class="line">curl http://localhost:3000/ -H &quot;Cookie: foo=bar,bar=baz&quot;</div><div class="line"></div><div class="line">签名cookie：</div><div class="line">有效的签名cookie放在res.signedCookies对象中，适合存放敏感数据，在服务器端使用哈希加密，形成如：tobi.IDJFPIWJVPIWJEIPVJPIO3POI49  这种值，改变值会导致解签失败：</div><div class="line">curl http://localhost:3000/ -H &quot;Cookie:name=luna.IDJFPIWJVPIWJEIPVJPIO3POI49&quot;</div><div class="line">&gt;&#123;name:&apos;luna&apos;&#125;</div><div class="line">&gt;GET / 200 4ms</div><div class="line"></div><div class="line">JSON cookie：</div><div class="line">特别的JSON cookie带有前缀j，可以是签名的也可以是未签名的：</div><div class="line">curl http://localhost:3000/ -H &apos;Cookie: foo=bar,bar=j:&#123;&quot;foo&quot;:&quot;bar&quot;&#125;&apos;</div><div class="line">&gt;&#123;foo:&apos;bar&apos;,bar:&#123;foo:&apos;bar&apos;&#125;&#125;</div><div class="line">&gt;GET / 200 4ms</div><div class="line"></div><div class="line">curl http://localhost:3000/ -H &apos;Cookie:cart=j:&#123;\&quot;items\&quot;:[1]&#125;.IDJFPIWJVPIWJEIPVJPIO3POI49&quot;</div><div class="line">&gt;&#123;cart:&#123;items:[1]&#125;&#125;</div><div class="line">&gt;GET / 200 4ms</div><div class="line"></div><div class="line">查看响应头：</div><div class="line">curl http://localhost:3000/ --head</div><div class="line">-----------------------------------------------------</div><div class="line">31.bodyParser()整合了三个组件：json(),urlencoded(),multipart()，提供了req.body属性，可解析JSON，x-www-form-urlencoded和multipart/form-data请求，如为multipart/form-data请求则还有req.file对象</div><div class="line">32.解析JSON数据：</div><div class="line">curl -d &apos;&#123;&quot;username&quot;:&quot;tobi&quot;&#125;&apos; -H &quot;Content-Type: application/json&quot; http://localhost Registered new user: tobi</div><div class="line"></div><div class="line">解析常规&lt;form&gt;数据：</div><div class="line">curl -d name=tobi http://localhost Registered new user: tobi</div><div class="line"></div><div class="line">解析multipart&lt;form&gt;数据：</div><div class="line">curl -F image=@photo.png -F name=tobi http://localhost</div><div class="line">可得到主体文件信息</div></pre></td></tr></table></figure>
<p>33.<img src="img/20170110181943.png" alt=""></p>
<p>34.<img src="img/20170110182526.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">35.日志选项stream,immediate,buffer</div><div class="line">stream调整logger的行为，可以给logger传递一个node stream实例用来代替stdout写入日志,使用定制格式，程序启动时日志文件不会被截断:</div><div class="line">fs.createWriteStream(&apos;/var/log/myapp.log&apos;,&#123;flags:&apos;a&apos;&#125;);</div><div class="line">···</div><div class="line">var app = connect()</div><div class="line">    .use(connect.logger(&#123;format:&apos;method :url&apos;,stream:log&#125;))</div><div class="line">    .use........</div><div class="line"></div><div class="line">immediate,一收到请求就写日志而不是响应后，如果是长连接需知何时开始，用此，不能使用status和response-time之类的信令，因为这类信令和响应相关，要启用即刻模式，可以传入取值为true的immediate：</div><div class="line">var app = connect()</div><div class="line">    .use(connect.logger(&#123;immediate：true&#125;))</div><div class="line">    .use........</div><div class="line">    </div><div class="line">buffer,接收数值韩淼单位指定缓冲区刷新间隔时间或使用true的默认间隔</div><div class="line">36.favicon()返回Connect的favicon，有默认图标，加url来指定，maxAge参数指定favicon的缓存时间，当客户端能力有限时提供一种方案用为伪造http请求方法：</div><div class="line">.use(connect.favicon(_dirname + &apos;/public/favicon.ico&apos;))...</div><div class="line">37.methodOverride(),因为大多浏览器只处理表单的post和get，所以对put，delete用特殊处理:</div><div class="line">.use(connect.methodOverride(&apos;_method_&apos;))...</div><div class="line">methodOverride()将原始的method值放在req.originalMethod中，然后修改了req.method并使用。</div><div class="line">38.vhost()通过请求头host路由请求的简单轻量的办法，vhost组件在同一个node进程中完成这一操作，将控制权交给chost实例关联的node http服务器，参数两个，主机名，http.server实例</div></pre></td></tr></table></figure></p>
<p><img src="img/20170111113640.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">个人感觉vhost就是做了反向代理的工作，将多个主机连同一个http服务，就这么，其实用nginx反向代理也是蛮方便的且更灵活</div><div class="line">39.session(),需要签名cookie，默认会话cookie名是cinnect.sid并且被设定为httpOnly。当请求完成时req.session的所有属性呗保存，可以当做一般对象对其属性赋值，值将会呗保存，如：</div><div class="line">req.session.cart = &#123; items:&#123;1,2,3&#125;&#125;;</div><div class="line">req.session.cart.items.push(4);</div><div class="line">会话对象在请求间会被JSON化（切记此限制）。connect的自动保存数据是通过内部调用session.save([callback])完成。</div><div class="line">session.cookie操作特定cookie，此默认为全局。</div><div class="line">会话5秒失效：</div><div class="line">req.session.cookie.expires = new Date(Date.now() + 5000);</div><div class="line">req.session.cookie.maxAge = 5000;</div><div class="line">会话作用域domain，路径path，安全连接secure</div><div class="line">其他例子：</div><div class="line">req.session.cookie.path = &apos;/admin&apos;;</div><div class="line">req.session.cookie.httpOnly = false;</div><div class="line">40.会话存储持久化，将connect引用传给connect-redis作为参数，它可以继承connect.session.Store.prototype指定模块的版本，RedisStore作为store的值传给session()，而例如会话key的前缀等可以传给RedisStore构造器，理解起来就是在session的store属性中设置存储位置，把RedisStore传进去，而RedisStore的参数就卸载自己里面</div></pre></td></tr></table></figure></p>
<p><img src="img/20170111121836.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div></pre></td><td class="code"><pre><div class="line">--------------------------------------</div><div class="line">41.提供安全的connect中间件</div><div class="line">basicAuth()提供的http基础认证</div><div class="line">基本用法：</div><div class="line">var app = connect()</div><div class="line">    .use(connect.basicAuth(&apos;tj&apos;,&apos;tobi&apos;));</div><div class="line">回调用法：</div><div class="line">var user = &#123;</div><div class="line">    tobi:&apos;foo&apos;,</div><div class="line">    loki:&apos;bar&apos;</div><div class="line">&#125;;</div><div class="line">var app = connect()</div><div class="line">app.use(connect.basicAuth(function(user,pass)&#123;</div><div class="line">    return users[user] === pass;</div><div class="line">&#125;));</div><div class="line">提供异步的回调,在code示例文件中</div><div class="line">csrf()跨站请求伪造防护基本用法,看得出是在后面使用：</div><div class="line">connect()</div><div class="line">    .use(connect.bodyParser())</div><div class="line">    .use(connect.cookieParser(&apos;secret&apos;))</div><div class="line">    .use(connect.session())</div><div class="line">    .use(connect.csrf());</div><div class="line">errorHandler()开发错误处理，看得出需要异步延时保证能捕捉到错误：</div><div class="line">var app = connect()</div><div class="line">    .use(connect.logger(&apos;dev&apos;))</div><div class="line">    .use(function(req,res,next)&#123;</div><div class="line">        setTimeout(function()&#123;</div><div class="line">            next(new Error(&apos;somethine broke!&apos;));</div><div class="line">        &#125;,500);</div><div class="line">    &#125;)</div><div class="line">    .use(connect.errorHandler());</div><div class="line">使用curl接收普通文本错误响应：</div><div class="line">curl http://localhost/</div><div class="line">使用curl接收JSON错误响应：</div><div class="line">curl http://localhost/ -H &quot;Accept: application/json&quot;</div><div class="line">42.提供静态服务的connect中间件</div><div class="line">static()默认不允许访问.开头的隐藏文件，拒绝有害的null字节</div><div class="line">基本用法：</div><div class="line">app.use(connect.static(&apos;public&apos;));</div><div class="line">带挂载：</div><div class="line">app.use(&apos;/app/files&apos;,connect.static(&apos;public&apos;));</div><div class="line">static()传的是相对路径，public作为路径传入会背解析为process.cwd() + &quot;public&quot;,要用绝对路径，要这么：</div><div class="line">app.use(&apos;/app/files&apos;,connect.static(__dirname + &apos;/public&apos;));</div><div class="line">请求目录是返回index.html：</div><div class="line">当请求的是目录并且目录下有index.html时可返回这个文件作为响应</div><div class="line">compress()压缩静态文件，zlib模块提供的gzip和deflate压缩解压数据机制，zlib包含在connect2.0中。通过Accept-Encoding自动检测可接受的编码，如请求中没有该域，就不会对响应作出处理，如gzip和deflate两都有则压缩响应</div><div class="line">基本用法:</div><div class="line">var app = connect()</div><div class="line">    .use(connect.compress())</div><div class="line">    .use(connect.static(&apos;static&apos;));</div><div class="line">app.listen(3000);</div><div class="line">使用定制的过滤器函数：</div><div class="line">默认的：</div><div class="line">exports.filter = function(req,res)&#123;</div><div class="line">    var type = req.getHeader(&apos;Content-Type&apos;)||&apos;&apos;;</div><div class="line">    return type.match(/json|text|javascript/);</div><div class="line">&#125;</div><div class="line">定制的：</div><div class="line">function filter(req)&#123;</div><div class="line">    var type = req.getHeader(&apos;Content-Type&apos;)||&apos;&apos;;</div><div class="line">    return 0 == type.indexOf(&apos;text/plain&apos;);</div><div class="line">&#125;</div><div class="line">connect()</div><div class="line">    .use(connect.conpress(&#123;filter:filter&#125;));</div><div class="line">指定压缩及内存水平,示例压缩水品低快：</div><div class="line">connect()</div><div class="line">    .use(connect.compress(&#123;level:3,memLevel:8&#125;))</div><div class="line">directory()目录列表，可远程浏览文件带有图标和导航的界面：</div><div class="line">基本用法：</div><div class="line">var app = connect()</div><div class="line">    .use(connect.directory(&apos;public&apos;))</div><div class="line">    .use(connect.static(&apos;public&apos;))</div><div class="line">app.listen(3000);</div><div class="line">使用挂载：</div><div class="line">var app = connect()</div><div class="line">    .use(&apos;/files&apos;,connect.directory(&apos;public&apos;,&#123;icons:true,hidden:true&#125;))</div><div class="line">    .use(&apos;/files&apos;,connect.static(&apos;public&apos;,&#123;hidden:true&#125;))</div><div class="line">    </div><div class="line">43.express基本命令</div><div class="line"></div><div class="line">Usage: express [options] [dir]</div><div class="line"></div><div class="line">Options:</div><div class="line"></div><div class="line">  -h, --help           output usage information</div><div class="line">      --version        output the version number</div><div class="line">  -e, --ejs            add ejs engine support</div><div class="line">      --pug            add pug engine support</div><div class="line">      --hbs            add handlebars engine support</div><div class="line">  -H, --hogan          add hogan.js engine support</div><div class="line">  -v, --view &lt;engine&gt;  add view &lt;engine&gt; support (ejs|hbs|hjs|jade|pug|twig|vash) (defaults to jade)</div><div class="line">  -c, --css &lt;engine&gt;   add stylesheet &lt;engine&gt; support (less|stylus|compass|sass) (defaults to plain css)</div><div class="line">      --git            add .gitignore</div><div class="line">  -f, --force          force on non-empty directory</div><div class="line">  </div><div class="line">4.x的新版express命令已从命令工具分离，需要额外安装，以下命令，搞了半天才查到，还以为要配环境：</div><div class="line">npm install -g express-generator</div><div class="line"></div><div class="line">指定-e使用EJS模板:</div><div class="line">express -e photo</div><div class="line"></div><div class="line">44.express环境驱动配置系统，由5个方法组成，全部有环境变量NODE_ENV驱动：</div><div class="line">configure()</div><div class="line">set()</div><div class="line">get()</div><div class="line">enable()</div><div class="line">disable()</div></pre></td></tr></table></figure></p>
<p><img src="img/20170111164609.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">基于环境的配置：</div><div class="line">设定特定的环境选项;</div><div class="line">app.configure(function()&#123;</div><div class="line">    app.set(&apos;views&apos;,__dirname + &apos;/views&apos;);</div><div class="line">    app.set(&apos;views engine&apos;, &apos;ejs&apos;);</div><div class="line">    ~</div><div class="line">&#125;);</div><div class="line">app.configure(&apos;development&apos;,function()&#123;</div><div class="line">    app.use(express.errorHandler());</div><div class="line">&#125;);</div><div class="line">用条件判断设定特定环境选项：</div><div class="line">var env = process.env.NODE_ENV || &apos;development&apos;;</div><div class="line">    app.set(&apos;views&apos;,__dirname + &apos;/views&apos;);</div><div class="line">    app.set(&apos;views engine&apos;, &apos;ejs&apos;);</div><div class="line">    ~</div><div class="line">    if(&apos;development&apos; == env)&#123;</div><div class="line">        app.use(express.errorHandler());</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">app.configure(function()&#123;</div><div class="line">    ~</div><div class="line">    app.set(&apos;photo&apos;,__dirname + &apos;/public/photos&apos;);</div><div class="line">    ~</div><div class="line">&#125;);</div><div class="line"></div><div class="line">app.configure(&apos;production&apos;,function()&#123;</div><div class="line">    ~</div><div class="line">    app.set(&apos;photos&apos;,&apos;/mounted-volume/photos&apos;);</div><div class="line">    ~</div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p><img src="img/20170111171330.png" alt=""><br><img src="img/20170111171856.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">设定指定ejs模板后指定无后缀的模板为ejs模板，这里需要说的是不同的模板适用于不同的场景，所以要根据需求好好选择不同的模板（自己也要好好的看一看有哪些模板）</div><div class="line">45.添加的额外模板需要在package.json依赖对象中指明，默认启动view  cache将模板读在内存，所以不重启服务器改动不会有效，在生产环境中应将其关闭.</div><div class="line">46.对于express数据模板读取数据的流程的理解：连接数据库建数据结构-&gt;引入这个数据结构-&gt;设置模板-&gt;设置路由get数据-&gt;模板中迭代处理解析数据</div></pre></td></tr></table></figure></p>
<p><img src="img/20170112124838.png" alt=""><br><img src="img/20170112125044.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">因为app.locals被做成JS函数，有对象传入时所有键被合并，将引用直接放在app.locals中将引用的所有内容放在视图中，这样理解：传入app.locals的对象会作为属性存在在视图内存中，但是跨请求就没用了，一旦重定向，需要信息就只能放在能更持久存在的地方，比如session中了。</div><div class="line">47.ejs上传：</div><div class="line">app.get(&apos;/upload&apos;,photos.form);</div><div class="line">app.post(&apos;/upload&apos;,photo.summit(app.get(&apos;photos&apos;)));</div><div class="line">48.创建空白EJS模板文件，如：</div><div class="line">touch views/menu.ejs</div><div class="line">49.使用redis-cli工具查看存储数据：</div><div class="line">redis-cli</div><div class="line">redis&gt; get user:ids</div><div class="line">&quot;1&quot;</div><div class="line">redis&gt; hgetall user:1</div><div class="line">redis&gt; quit</div><div class="line">50.创建公开REST API：设计get/post路由-&gt;添加认证-&gt;实现路由，连接数据库，过滤敏感数据，做业务-&gt;内容协商（提供JSON和XML格式的API由使用者决定用什么，HTTP通过Accept请求头提供内容协商，如：Accept:text/plain;q=0.5,text/html，q是品质值，高的优先使用；Express会解析这个信息并提供一个股繁华的req.accepted数组，还提供res.format()方法，参数是一个MIME类型数组和一些回调）-&gt;错误处理模板，路由，启用中间件</div></pre></td></tr></table></figure></p>
<p><img src="img/20170120005120.png" alt=""><br><img src="img/20170120005227.png" alt=""><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">51.TDD驱动测试开发BDD行为驱动开发，区别只在描述测试的语言上</div></pre></td></tr></table></figure></p>
<p><img src="img/20170120005742.png" alt=""></p>
<p>#notice<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">building websocket need load socket.io.js in html, this&apos;s websocket code for js, this&apos;s must</div></pre></td></tr></table></figure></p>
<p><a href="https://en.wikipedia.org/wiki/Directory_traversal_attack" target="_blank" rel="external">目录遍历攻击</a></p>
<p><a href="https://github.com/substack/stream-handbook" target="_blank" rel="external">数据流手册</a></p>
<p><a href="http://blog.csdn.net/thor027/article/details/52369773" target="_blank" rel="external">openssl证书</a></p>
<p><a href="http://javascript.ruanyifeng.com/nodejs/packagejson.html" target="_blank" rel="external">package.json文件说明</a></p>
<p><a href="http://mongoosejs.com/docs/api.html" target="_blank" rel="external">mongoosejs官方API</a></p>
<p><a href="http://www.cnblogs.com/jayruan/p/5123754.html" target="_blank" rel="external">博客园：mongoosej全面理解</a></p>
<p><a href="http://blog.csdn.net/anhuizhuanjiao/article/details/50888552" target="_blank" rel="external">connect自带中间件</a></p>
<p><a href="https://curl.haxx.se/" target="_blank" rel="external">curl官方</a></p>
<p><a href="http://www.cnblogs.com/gbyukg/p/3326825.html" target="_blank" rel="external">curl常用命令</a></p>
<p><a href="http://www.cnblogs.com/Darren_code/p/node_express.html" target="_blank" rel="external">一篇老旧的express文章</a></p>
<p><a href="http://en.wikipedia.org/wiki/Rainbow_table" target="_blank" rel="external">wiki彩虹表攻击</a></p>
<p><a href="http://redis.io/commands" target="_blank" rel="external">redis-cli命令</a></p>
<hr>
<p>###package.json Example<br><figure class="highlight json"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">  <span class="attr">"name"</span>: <span class="string">"chatrooms"</span>,</div><div class="line">  <span class="attr">"version"</span>: <span class="string">"0.0.1"</span>,</div><div class="line">  <span class="attr">"description"</span>: <span class="string">"Minimalist multiroom chat server"</span>,</div><div class="line">  <span class="attr">"dependencies"</span>: &#123;</div><div class="line">    <span class="attr">"socket.io"</span>: <span class="string">"~0.9.6"</span>,</div><div class="line">     <span class="attr">"mime"</span>: <span class="string">"~1.2.7"</span></div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>###Server Example</p>
<blockquote>
<p>send404</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">send404</span>(<span class="params">response</span>) </span>&#123;</div><div class="line">  response.writeHead(<span class="number">404</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/plain'</span>&#125;);</div><div class="line">  response.write(<span class="string">'Error 404: resource not found.'</span>);</div><div class="line">  response.end();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>sendFile</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">sendFile</span>(<span class="params">response, filePath, fileContents</span>) </span>&#123;</div><div class="line">  response.writeHead(<span class="number">200</span>,&#123;<span class="string">"content-type"</span>: mime.lookup(path.basename(filePath))&#125;);</div><div class="line">  response.end(fileContents);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>choice 200 or 404(get static files serve)</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">serveStatic</span>(<span class="params">response, cache, absPath</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (cache[absPath]) &#123;</div><div class="line">    sendFile(response, absPath, cache[absPath]);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    fs.exists(absPath, <span class="function"><span class="keyword">function</span>(<span class="params">exists</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (exists) &#123;</div><div class="line">        fs.readFile(absPath, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (err) &#123;</div><div class="line">            send404(response);</div><div class="line">          &#125; <span class="keyword">else</span> &#123;</div><div class="line">            cache[absPath] = data;</div><div class="line">            sendFile(response, absPath, data);</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        send404(response);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<blockquote>
<p>http.createServer</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">request, response</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> filePath = <span class="literal">false</span>;</div><div class="line"></div><div class="line">  <span class="keyword">if</span> (request.url == <span class="string">'/'</span>) &#123;</div><div class="line">    filePath = <span class="string">'public/index.html'</span>;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    filePath = <span class="string">'public'</span> + request.url;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="keyword">var</span> absPath = <span class="string">'./'</span> + filePath;</div><div class="line">  serveStatic(response, cache, absPath);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<blockquote>
<p>server.listen</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">server.listen(<span class="number">3000</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.log(<span class="string">"Server listening on port 3000."</span>);</div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="comment">//use './lib/chat_server'js to open &amp; listen server</span></div><div class="line"><span class="keyword">var</span> chatServer = <span class="built_in">require</span>(<span class="string">'./lib/chat_server'</span>);</div><div class="line">chatServer.listen(server);</div></pre></td></tr></table></figure>
<p>###callback Example</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line">http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (req.url == <span class="string">'/'</span>) &#123;</div><div class="line">    fs.readFile(<span class="string">'./titles.json'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">      <span class="keyword">if</span> (err) &#123;</div><div class="line">        <span class="built_in">console</span>.error(err);</div><div class="line">        res.end(<span class="string">'Server Error'</span>);</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">var</span> titles = <span class="built_in">JSON</span>.parse(data.toString());</div><div class="line"></div><div class="line">        fs.readFile(<span class="string">'./template.html'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</div><div class="line">          <span class="keyword">if</span> (err) &#123;</div><div class="line">            <span class="built_in">console</span>.error(err);</div><div class="line">            res.end(<span class="string">'Server Error'</span>);</div><div class="line">          &#125;</div><div class="line">          <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">var</span> tmpl = data.toString();</div><div class="line"></div><div class="line">            <span class="keyword">var</span> html = tmpl.replace(<span class="string">'%'</span>, titles.join(<span class="string">'&lt;/li&gt;&lt;li&gt;'</span>));</div><div class="line">            res.writeHead(<span class="number">200</span>, &#123;<span class="string">'Content-Type'</span>: <span class="string">'text/html'</span>&#125;);</div><div class="line">            res.end(html);</div><div class="line">          &#125;</div><div class="line">        &#125;);</div><div class="line">      &#125;</div><div class="line">    &#125;);</div><div class="line">  &#125;</div><div class="line">&#125;).listen(<span class="number">8000</span>, <span class="string">"127.0.0.1"</span>);</div></pre></td></tr></table></figure>
<p>###error Exmple</p>
<p>通常：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>);</div><div class="line"><span class="keyword">var</span> myEmitter = <span class="keyword">new</span> event.EventEmitter();</div><div class="line">myEmitter.on(<span class="string">'error'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.log(<span class="string">'Error: '</span> + err.mseeage);</div><div class="line">&#125;);</div><div class="line">myEmitter.emit(<span class="string">'error'</span>, <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Somethine is wrong'</span>));</div></pre></td></tr></table></figure></p>
<p>定义全局处理器实现响应逻辑处理未指明错误事件的错误：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">process.on(<span class="string">'uncaughtException'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    <span class="built_in">console</span>.error(err.stack);</div><div class="line">    process.exit(<span class="number">1</span>);</div><div class="line">&#125;)</div></pre></td></tr></table></figure></p>
<p>###return listens count Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">channel.on(<span class="string">'join'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">id,client</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> welcome = <span class="string">"Welcome!\n"</span></div><div class="line">        + <span class="string">'Guest online: '</span> + <span class="keyword">this</span>.listen(<span class="string">'broadcast'</span>).length;</div><div class="line">    client.write(welcome + <span class="string">"\n"</span>);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>###set max listens Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">channel.setMaxListens(<span class="number">50</span>);</div></pre></td></tr></table></figure>
<p>###event watcher Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">Wacther</span>(<span class="params">watchDir,processedDir</span>)</span>&#123;</div><div class="line">    <span class="keyword">this</span>.watchDir = watchDir;</div><div class="line">    <span class="keyword">this</span>.processedDir = processedDir;</div><div class="line">&#125;</div><div class="line"><span class="keyword">var</span> events = <span class="built_in">require</span>(<span class="string">'events'</span>),</div><div class="line">    util = <span class="built_in">require</span>(<span class="string">'util'</span>);</div><div class="line">util.inherits(Watcher,events.EventEmitter);<span class="comment">//-&gt;equal = Watcher.prototype = new events.EventEmitter();</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>)</div><div class="line">  , watchDir = <span class="string">'./watch'</span></div><div class="line">  , processedDir  = <span class="string">'./done'</span>;</div><div class="line"></div><div class="line">Watcher.prototype.watch = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">  <span class="keyword">var</span> watcher = <span class="keyword">this</span>;</div><div class="line">  fs.readdir(<span class="keyword">this</span>.watchDir, <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</div><div class="line">    <span class="keyword">for</span>(index <span class="keyword">in</span> files) &#123;</div><div class="line">      watcher.emit(<span class="string">'process'</span>, files[index]); </div><div class="line">    &#125;</div><div class="line">  &#125;)</div><div class="line">&#125;</div><div class="line"></div><div class="line">Watcher.prototype.start = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </div><div class="line">  <span class="keyword">var</span> watcher = <span class="keyword">this</span>;</div><div class="line">  fs.watchFile(watchDir, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</div><div class="line">    watcher.watch();</div><div class="line">  &#125;);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> watcher = <span class="keyword">new</span> Watcher(watchDir, processedDir);</div><div class="line"></div><div class="line">watcher.on(<span class="string">'process'</span>, <span class="function"><span class="keyword">function</span> <span class="title">process</span>(<span class="params">file</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> watchFile      = <span class="keyword">this</span>.watchDir + <span class="string">'/'</span> + file;</div><div class="line">  <span class="keyword">var</span> processedFile  = <span class="keyword">this</span>.processedDir + <span class="string">'/'</span> + file.toLowerCase();</div><div class="line"></div><div class="line">  fs.rename(watchFile, processedFile, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">watcher.start();</div></pre></td></tr></table></figure>
<p>###data transmission Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> parse = <span class="built_in">require</span>(<span class="string">'url'</span>).parse;</div><div class="line"><span class="keyword">var</span> join = <span class="built_in">require</span>(<span class="string">'path'</span>).join;</div><div class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> root = __dirname;</div><div class="line"></div><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> url = parse(req.url);</div><div class="line">  <span class="keyword">var</span> path = join(root, url.pathname);</div><div class="line">  <span class="keyword">var</span> stream = fs.createReadStream(path);</div><div class="line">  stream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;<span class="comment">//</span></div><div class="line">    res.write(chunk);</div><div class="line">  &#125;);</div><div class="line">  stream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">    res.end();</div><div class="line">  &#125;);</div><div class="line">  stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">    res.statusCode = <span class="number">500</span>;</div><div class="line">    res.end(<span class="string">'Internal Server Error'</span>);</div><div class="line">  &#125;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">server.listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>###preset life handle Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> server = http.createServer(<span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123;</div><div class="line">  <span class="keyword">var</span> url = parse(req.url);</div><div class="line">  <span class="keyword">var</span> path = join(root, url.pathname);</div><div class="line">  fs.stat(path, <span class="function"><span class="keyword">function</span>(<span class="params">err, stat</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span> (err) &#123;</div><div class="line">      <span class="keyword">if</span> (<span class="string">'ENOENT'</span> == err.code) &#123;</div><div class="line">        res.statusCode = <span class="number">404</span>;</div><div class="line">        res.end(<span class="string">'Not Found'</span>);</div><div class="line">      &#125; <span class="keyword">else</span> &#123;</div><div class="line">        res.statusCode = <span class="number">500</span>;</div><div class="line">        res.end(<span class="string">'Internal Server Error'</span>);</div><div class="line">      &#125;</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      res.setHeader(<span class="string">'Content-Length'</span>, stat.size);</div><div class="line">      <span class="keyword">var</span> stream = fs.createReadStream(path);</div><div class="line">      stream.pipe(res);</div><div class="line">      stream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</div><div class="line">        res.statusCode = <span class="number">500</span>;</div><div class="line">        res.end(<span class="string">'Internal Server Error'</span>);</div><div class="line">      &#125;);</div><div class="line">    &#125;</div><div class="line">  &#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>###pages transmission Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">show</span>(<span class="params">res</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> html = <span class="string">'&lt;html&gt;&lt;head&gt;&lt;title&gt;Todo List&lt;/title&gt;&lt;/head&gt;&lt;/body&gt;'</span></div><div class="line">    + <span class="string">'&lt;h1&gt;Todo List&lt;/h1&gt;'</span></div><div class="line">    + <span class="string">'&lt;ul&gt;'</span></div><div class="line">    + items.map(<span class="function"><span class="keyword">function</span>(<span class="params">item</span>)</span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">'&lt;li&gt;'</span> + item +<span class="string">'&lt;/li&gt;'</span></div><div class="line">      &#125;).join(<span class="string">''</span>)</div><div class="line">    + <span class="string">'&lt;/ul&gt;'</span></div><div class="line">    + <span class="string">'&lt;form method="post" action="/"&gt;'</span></div><div class="line">    + <span class="string">'&lt;p&gt;&lt;input type="text" name="item"&gt;&lt;/p&gt;'</span></div><div class="line">    + <span class="string">'&lt;p&gt;&lt;input type="submit" value="Add Item"&gt;&lt;/p&gt;'</span></div><div class="line">    + <span class="string">'&lt;/form&gt;&lt;/body&gt;&lt;/html&gt;'</span>;</div><div class="line">    res.setHeader(<span class="string">'Content-Type'</span>,<span class="string">'text/html'</span>);</div><div class="line">    res.setHeader(<span class="string">'Context-Length'</span>,Buffer.byteLength(html));</div><div class="line">    res.end(html);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">notFound</span>(<span class="params">res</span>)</span>&#123;</div><div class="line">    res.statusCode = <span class="number">404</span>;</div><div class="line">    res.setHeader(<span class="string">'Content-Tpye'</span>,<span class="string">'text/plain'</span>);</div><div class="line">    res.end(<span class="string">'Not Found'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">badRequest</span>(<span class="params">res</span>)</span>&#123;</div><div class="line">    res.statusCode = <span class="number">400</span>;</div><div class="line">    res.setHeader(<span class="string">'Content-Tpye'</span>,<span class="string">'text/plain'</span>);</div><div class="line">    res.end(<span class="string">'Bad Reques'</span>);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> qs = <span class="built_in">require</span>(<span class="string">'querystring'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> body =<span class="string">''</span>;</div><div class="line">    req.setEncode(<span class="string">'utf-8'</span>);</div><div class="line">    req.on(<span class="string">'data'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">chunk</span>)</span>&#123;body += chunk&#125;);</div><div class="line">    req.on(<span class="string">'end'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">        <span class="keyword">var</span> obj = qs.parse(body);</div><div class="line">        items.push(obj.item);</div><div class="line">        show(res);</div><div class="line">    &#125;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>###formidable Exmple(unsort)</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> http = <span class="built_in">require</span>(<span class="string">'http'</span>);</div><div class="line"><span class="keyword">var</span> formidable = <span class="built_in">require</span>(<span class="string">'formidable'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">isFormData</span>(<span class="params">req</span>)</span>&#123;</div><div class="line">    <span class="keyword">var</span> type = req.headers[<span class="string">'content-type'</span>] || <span class="string">''</span>;</div><div class="line">    <span class="keyword">return</span> <span class="number">0</span> == type.indexOf(<span class="string">'multipart/form-data'</span>);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">upload</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">    <span class="keyword">if</span>(!isFormData(req))&#123;</div><div class="line">        res.statusCode = <span class="number">400</span>;</div><div class="line">        res.end(<span class="string">'Bad Request: expecting multipart/form-data'</span>);</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</div><div class="line">    form.parse(req);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> form = <span class="keyword">new</span> formidable.IncomingForm();</div><div class="line"></div><div class="line">form.on(<span class="string">'field'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">field,value</span>)</span>&#123;</div></pre></td></tr></table></figure>
<p>});</p>
<p>form.on(‘file’,function(name,file){<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">&#125;);</div><div class="line"></div><div class="line">form.on(&apos;end&apos;,function()&#123;</div><div class="line">    res.end(&apos;upload complete!&apos;);</div><div class="line">&#125;);</div><div class="line"></div><div class="line">//advanced function:</div><div class="line">form.parse(req,function(err,fields,file)&#123;</div></pre></td></tr></table></figure></p>
<pre><code>res.end(&apos;upload complete!&apos;);
</code></pre><p>});</p>
<p>//progress:<br>form.on(‘progress’,function(bytesReceived,bytesExpected){<br>    var percent = Math.floor(byteReceived/bytesExpected * 100);<br>    console.log(percent);<br>});<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###HTTPS Exmple(unsort)</div><div class="line"></div><div class="line">```javascript</div><div class="line">var https = require(&apos;https&apos;);</div><div class="line">var fs = require(&apos;fs&apos;);</div><div class="line"></div><div class="line">var options = &#123;</div><div class="line">    key: fs.readFileSync(&apos;./key.pem&apos;),</div><div class="line">    cert: fs.readFileSync(&apos;./cert.pem&apos;)</div><div class="line">&#125;;</div><div class="line"></div><div class="line">https.createServer(options, function(req,res)&#123;</div><div class="line">    res.writeHead(200);</div><div class="line">    res.end(&apos;hello world\n&apos;);</div><div class="line">&#125;).listen(3000);</div></pre></td></tr></table></figure></p>
<p>###Configurable connect Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">setup</span>(<span class="params">options</span>)</span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">req,res,next</span>)</span>&#123;</div><div class="line">        <span class="comment">//············</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">app.use(setup(&#123;<span class="attr">some</span>:<span class="string">'options'</span>&#125;));</div></pre></td></tr></table></figure>
<p>###connect Error Exmple</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">hello</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (req.url.match(<span class="regexp">/^\/hello/</span>)) &#123;</div><div class="line">    res.end(<span class="string">'Hello World\n'</span>);</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    next();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">var</span> db = &#123;</div><div class="line">  <span class="attr">users</span>: [</div><div class="line">    &#123; <span class="attr">name</span>: <span class="string">'tobi'</span> &#125;,</div><div class="line">    &#123; <span class="attr">name</span>: <span class="string">'loki'</span> &#125;,</div><div class="line">    &#123; <span class="attr">name</span>: <span class="string">'jane'</span> &#125;</div><div class="line">  ]</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">users</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="keyword">var</span> match = req.url.match(<span class="regexp">/^\/user\/(.+)/</span>);</div><div class="line">  <span class="keyword">if</span> (match) &#123;</div><div class="line">    <span class="keyword">var</span> user = db.users[match[<span class="number">1</span>]];</div><div class="line">    <span class="keyword">if</span> (user) &#123;</div><div class="line">      res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</div><div class="line">      res.end(<span class="built_in">JSON</span>.stringify(user));</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">      <span class="keyword">var</span> err = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'User not found'</span>);</div><div class="line">      err.notFound = <span class="literal">true</span>;</div><div class="line">      next(err);</div><div class="line">    &#125;</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    next();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">pets</span>(<span class="params">req, res, next</span>) </span>&#123;</div><div class="line">  <span class="keyword">if</span> (req.url.match(<span class="regexp">/^\/pet\/(.+)/</span>)) &#123;</div><div class="line">    foo();</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    next();</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">function</span> <span class="title">errorHandler</span>(<span class="params">err, req, res, next</span>) </span>&#123;</div><div class="line">  <span class="built_in">console</span>.error(err.stack);</div><div class="line">  res.setHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/json'</span>);</div><div class="line">  <span class="keyword">if</span> (err.notFound) &#123;</div><div class="line">    res.statusCode = <span class="number">404</span>;</div><div class="line">    res.end(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">error</span>: err.message &#125;));</div><div class="line">  &#125; <span class="keyword">else</span> &#123;</div><div class="line">    res.statusCode = <span class="number">500</span>;</div><div class="line">    res.end(<span class="built_in">JSON</span>.stringify(&#123; <span class="attr">error</span>: <span class="string">'Internal Server Error'</span> &#125;));</div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">connect()</div><div class="line">  .use(users)</div><div class="line">  .use(pets)</div><div class="line">  .use(errorHandler)</div><div class="line">  .use(hello)</div><div class="line">  .listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure>
<p>###connect cookie Exmple<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</div><div class="line"><span class="keyword">var</span> app = connect()</div><div class="line">    .use(conncet.cookieParser(<span class="string">'tobi is a cool ferret'</span>))</div><div class="line">    .use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        <span class="built_in">console</span>.log(req.cookies);</div><div class="line">        <span class="built_in">console</span>.log(req.signedCookies);</div><div class="line">        res.end(<span class="string">'hello\n'</span>);</div><div class="line">    &#125;).listen(<span class="number">3000</span>);</div><div class="line">    </div><div class="line"><span class="comment">//or set out cookie:</span></div><div class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</div><div class="line"><span class="keyword">var</span> app = connect()</div><div class="line">    .use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        res.setHeader(<span class="string">'Set-Cookie'</span>,<span class="string">'foo=bar'</span>);</div><div class="line">        res.setHeader(<span class="string">'Set-Cookie'</span>,<span class="string">'tobi=ferret;Expires=Tue,08 Jun 2021 10:18:14 GMT '</span>);</div><div class="line">        res.end();</div><div class="line">    &#125;).listen(<span class="number">3000</span>);</div></pre></td></tr></table></figure></p>
<p>###connect JSON Exmple<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> connect = <span class="built_in">require</span>(<span class="string">'connect'</span>);</div><div class="line"><span class="keyword">var</span> app = connect()</div><div class="line">    .use(conncet.bodyParser())</div><div class="line">    .use(<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</div><div class="line">        <span class="comment">//`</span></div></pre></td></tr></table></figure></p>
<pre><code>    res.end(&apos; &apos;+req.body.username);
});
</code></pre><p>//or:<br>var connect = require(‘connect’);<br>var app = connect()<br>    .use(connect.bodyParser())<br>    .use(function(req,res){<br>        console.log(req.body);<br>        console.log(req.files);<br>        res.end(‘xxx’);<br>    });<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">###connect query Exmple</div><div class="line">```javascript</div><div class="line">var connect = require(&apos;connect&apos;);</div><div class="line">var app = connect()</div><div class="line">    .use(conncet.query())</div><div class="line">    .use(fucntion(req,res,next)&#123;</div><div class="line">        res.setHeader(&apos;Content-Type&apos;,&apos;application/json&apos;);</div><div class="line">        res.end(JSON.stringify(req.query));</div><div class="line">    &#125;);</div></pre></td></tr></table></figure></p>
<p>###use ejs get data Exmple<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  ../models/Photo:</span></div><div class="line"><span class="keyword">var</span> mongoose = <span class="built_in">require</span>(<span class="string">'mongoose'</span>);</div><div class="line">mongoose.connect(<span class="string">'mongodb://localhost/photo_app'</span>);</div><div class="line"></div><div class="line"><span class="keyword">var</span> schema = <span class="keyword">new</span> mongoose.Schema(&#123;</div><div class="line">  <span class="attr">name</span>: <span class="built_in">String</span>,</div><div class="line">  <span class="attr">path</span>: <span class="built_in">String</span></div><div class="line">&#125;);</div><div class="line"></div><div class="line"><span class="built_in">module</span>.exports = mongoose.model(<span class="string">'Photo'</span>, schema);</div><div class="line"></div><div class="line"><span class="comment">//  app.js</span></div><div class="line"></div><div class="line"><span class="keyword">var</span> Photo = <span class="built_in">require</span>(<span class="string">'../models/Photo'</span>);</div><div class="line"></div><div class="line"><span class="comment">//  get data &amp; use model photos</span></div><div class="line">exports.list = <span class="function"><span class="keyword">function</span>(<span class="params">req, res</span>)</span>&#123; res.render(<span class="string">'photos'</span>, &#123;</div><div class="line">  <span class="attr">title</span>: <span class="string">'Photos'</span>,</div><div class="line">  <span class="attr">photos</span>: photos &#125;);</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="keyword">var</span> routes = <span class="built_in">require</span>(<span class="string">'./routes'</span>);</div><div class="line"><span class="keyword">var</span> photos = <span class="built_in">require</span>(<span class="string">'./routes/photos'</span>);</div><div class="line"></div><div class="line">app.get(<span class="string">'/'</span>,photo.list);</div><div class="line"></div><div class="line"><span class="comment">//  foreach write to html model</span></div><div class="line">&lt;% photos.forEach(<span class="function"><span class="keyword">function</span>(<span class="params">photo</span>) </span>&#123; %&gt;</div><div class="line">&lt;div class="photo"&gt;</div><div class="line">   &lt;h2&gt;&lt;%=photo.name%&gt;&lt;/h2&gt;</div><div class="line">      &lt;a href='/photo/&lt;%=photo.id%&gt;/download'&gt;</div><div class="line">        &lt;img src='/photos/&lt;%=photo.path%&gt;'/&gt;</div><div class="line">      &lt;/a&gt;</div><div class="line">&lt;/div&gt;</div><div class="line">&lt;% &#125;) %&gt;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://jumpu.top/2017/01/02/node common function/" data-id="ciz6pbxnz0008sgkwa7ttlrmx" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/page/6/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="page-number" href="/page/9/">9</a><a class="page-number" href="/page/10/">10</a><a class="extend next" rel="next" href="/page/8/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/DB-nosql-sql/">DB nosql sql</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEAN-mongoDB-express-nodeJS-angular/">MEAN mongoDB express nodeJS angular</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/MEAN-nodeJS/">MEAN nodeJS</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">标签云</h3>
    <div class="widget tagcloud">
      <a href="/tags/DB-nosql-sql/" style="font-size: 10px;">DB nosql sql</a> <a href="/tags/MEAN-mongoDB-express-nodeJS-angular/" style="font-size: 10px;">MEAN mongoDB express nodeJS angular</a> <a href="/tags/MEAN-nodeJS/" style="font-size: 10px;">MEAN nodeJS</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">归档</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/02/">二月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/01/">一月 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/12/">十二月 2016</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最新文章</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/02/15/ionic2build/">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/02/15/MongoDB doucment/">database_choice</a>
          </li>
        
          <li>
            <a href="/2017/02/15/testone/">testone</a>
          </li>
        
          <li>
            <a href="/2017/02/15/hello-world/">Hello World</a>
          </li>
        
          <li>
            <a href="/2017/01/16/MEAN本地服务器安装/">MEAN本地服务器安装</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 AN.<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>